<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Vodojem PÃ¡vice</title>

<style>
:root{
  --max-level-cm:243;
  --max-volume:44262;
  --accent:#0078d7;
}

html,body{height:100%;margin:0}
body{
  font-family:"Segoe UI",Tahoma,Arial,sans-serif;
  background:#f6f8fa;
  color:#222;
  display:flex;
  justify-content:center;
  padding:14px;
}
.container{width:100%;max-width:900px}

header{
  display:flex;align-items:center;gap:12px;
  background:#fff;padding:14px;border-radius:12px;
  box-shadow:0 6px 14px rgba(0,0,0,0.06);
  margin-bottom:14px;
}
.signal-icon{
  width:82px;height:82px;border-radius:50%;
  background:var(--accent);color:#fff;
  display:flex;align-items:center;justify-content:center;
  font-size:34px;
}
header h1{margin:0;font-size:1.4rem}
.signal-strength{font-size:0.92rem;color:#666}

.svg-wrap{
  background:#fff;padding:12px;border-radius:12px;
  box-shadow:0 6px 18px rgba(0,0,0,0.05);
  margin-bottom:14px;text-align:center;
}
.svg-title{font-weight:700;font-size:1.1rem;margin-bottom:6px}
.svg-sub{font-weight:900;font-size:1.2rem}

.card{
  background:#fff;padding:12px;border-radius:12px;
  box-shadow:0 6px 14px rgba(0,0,0,0.05);
  margin-bottom:12px
}
.title-row{display:flex;align-items:center;gap:8px;color:var(--accent);font-weight:700;margin-bottom:8px}
.value{font-size:2rem;font-weight:800}
.unit{color:#666;font-size:0.95rem}
.small{font-size:0.9rem;color:#666}

.progress-bar{width:100%;height:12px;background:#eee;border-radius:8px;overflow:hidden;margin-top:8px}
.progress-fill{height:100%;width:0;background:#22c55e;border-radius:8px}

canvas{width:100%!important;height:420px!important}
</style>
</head>

<body>
<div class="container">

<header>
  <div class="signal-icon">ðŸ“¡</div>
  <div style="flex:1">
    <h1>Vodojem PÃ¡vice</h1>
    <div class="signal-strength">SÃ­la signÃ¡lu: <span id="signalStrength">â€“</span></div>
  </div>
</header>

<div class="svg-wrap">
  <div class="svg-title">AktuÃ¡lnÃ­ zaplnÄ›nÃ­</div>
  <div class="svg-sub" id="svgSubtitle">â€” l</div>

  <!-- SVG NÃDRÅ½ -->
  <svg viewBox="0 0 500 400" width="340" height="260">

    <defs>
      <clipPath id="tankClip">
        <path d="M30,380 L470,380 C460,260 430,140 350,50 L150,50 C70,140 40,260 30,380 Z"/>
      </clipPath>

      <linearGradient id="waterGrad" x1="0" x2="0" y1="0" y2="1">
        <stop offset="0%" stop-color="#5fb8ff"/>
        <stop offset="100%" stop-color="#0f62c9"/>
      </linearGradient>
    </defs>

    <!-- obrys -->
    <path d="M30,380 L470,380 C460,260 430,140 350,50 L150,50 C70,140 40,260 30,380 Z"
          fill="#f5f7fa" stroke="#bbb"/>

    <!-- voda -->
    <g clip-path="url(#tankClip)">
      <rect id="waterRect" x="0" y="380" width="500" height="0" fill="url(#waterGrad)"/>
    </g>

    <!-- text -->
    <text id="svgPercent" x="250" y="210"
          style="font-size:26px;font-weight:900;text-anchor:middle">â€” %</text>

    <text id="svgLiters" x="250" y="175"
          style="font-size:30px;font-weight:800;fill:#fff;text-anchor:middle">â€” l</text>

  </svg>
</div>

<div class="card">
  <div class="title-row">ðŸ’§ Hladina</div>
  <div style="display:flex;gap:8px;align-items:baseline">
    <div class="value" id="levelValue">â€“</div>
    <div class="unit">cm</div>
  </div>
  <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
  <div class="small">max 243 cm</div>
</div>

<div class="card">
  <div class="title-row">ðŸš° PrÅ¯tok</div>
  <div style="display:flex;gap:8px;align-items:baseline">
    <div class="value" id="flowValue">â€“</div>
    <div class="unit">L/min</div>
  </div>
</div>

</div>

<script>
// ================= OBJEM â€“ NEMÄšNÄšNO =================
function getLiters(height_cm){
  const L=5.9, slope=0.15, maxH=2.45;
  const profile=[[0,0],[4.4,0],[3.12,2.45],[1.28,2.45]];
  let h0=height_cm/100; if(h0<=0) return 0; if(h0>maxH) h0=maxH;
  const h1=Math.max(0,h0-slope);

  function area(p){
    let a=0;
    for(let i=0;i<p.length;i++){
      const j=(i+1)%p.length;
      a+=p[i][0]*p[j][1]-p[j][0]*p[i][1];
    }
    return Math.abs(a)/2;
  }
  function clip(p,h){
    const o=[];
    for(let i=0;i<p.length;i++){
      const A=p[i],B=p[(i+1)%p.length];
      const Ain=A[1]<=h,Bin=B[1]<=h;
      if(Ain) o.push(A);
      if(Ain^Bin){
        const t=(h-A[1])/(B[1]-A[1]);
        o.push([A[0]+t*(B[0]-A[0]),h]);
      }
    }
    return o;
  }
  function areaAt(d){
    const c=clip(profile,d);
    return c.length<3?0:area(c);
  }
  let sum=0,steps=300,dx=L/steps;
  for(let i=0;i<=steps;i++){
    const t=i/steps,d=h0+(h1-h0)*t;
    const k=(i===0||i===steps)?1:(i%2?4:2);
    sum+=k*areaAt(d);
  }
  return sum*dx/3*1000;
}

// ================= DATA =================
const MAX_LEVEL_CM = 243;
const MAX_VOLUME  = 44262;

async function fetchData(){
  const r = await fetch("https://api.thingspeak.com/channels/1214142/feeds.json?results=1&api_key=SGHZ5KIDVYK3BG1M");
  const j = await r.json();
  const d = j.feeds[0];

  const level = parseFloat(d.field2);
  const flow  = parseFloat(d.field3);

  const volume = getLiters(level);
  const percent = Math.min(100,(volume/MAX_VOLUME)*100);

  // texty
  levelValue.textContent = level.toFixed(1);
  flowValue.textContent  = flow.toFixed(2);
  svgLiters.textContent  = Math.round(volume).toLocaleString("cs-CZ")+" l";
  svgSubtitle.textContent= svgLiters.textContent;
  svgPercent.textContent = Math.round(percent)+" %";

  // ====== JEDINÃ DÅ®LEÅ½ITÃ ÄŒÃST â€“ GRAFIKA PODLE CM ======
  const WATER_TOP = 50;
  const WATER_BOTTOM = 380;
  const WATER_HEIGHT = WATER_BOTTOM - WATER_TOP;

  const ratio = Math.max(0,Math.min(1,level/MAX_LEVEL_CM));
  const waterH = ratio * WATER_HEIGHT;
  const waterY = WATER_BOTTOM - waterH;

  waterRect.setAttribute("y",waterY);
  waterRect.setAttribute("height",waterH);

  progressFill.style.width = ratio*100+"%";
}

fetchData();
</script>
</body>
</html>


